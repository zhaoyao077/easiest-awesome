[
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1473464387",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1473464387",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1473464387,
    "node_id": "IC_kwDOAQXtWs5X00hD",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-17T09:07:11Z",
    "updated_at": "2023-03-17T09:07:11Z",
    "author_association": "MEMBER",
    "body": "cc @cloud-fan ",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1473464387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1474925826",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1474925826",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1474925826,
    "node_id": "IC_kwDOAQXtWs5X6ZUC",
    "user": {
      "login": "VindhyaG",
      "id": 15109987,
      "node_id": "MDQ6VXNlcjE1MTA5OTg3",
      "avatar_url": "https://avatars.githubusercontent.com/u/15109987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/VindhyaG",
      "html_url": "https://github.com/VindhyaG",
      "followers_url": "https://api.github.com/users/VindhyaG/followers",
      "following_url": "https://api.github.com/users/VindhyaG/following{/other_user}",
      "gists_url": "https://api.github.com/users/VindhyaG/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/VindhyaG/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/VindhyaG/subscriptions",
      "organizations_url": "https://api.github.com/users/VindhyaG/orgs",
      "repos_url": "https://api.github.com/users/VindhyaG/repos",
      "events_url": "https://api.github.com/users/VindhyaG/events{/privacy}",
      "received_events_url": "https://api.github.com/users/VindhyaG/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-18T17:38:48Z",
    "updated_at": "2023-03-18T17:38:48Z",
    "author_association": "NONE",
    "body": "Can you please explain more on scenarios when rebalancepartitions becomes child of locallimit? i tried  \r\nSELECT  * FROM t WHERE id > 1 LIMIT 5; with spark 2.4.4 version and rebalancepartitions is not part of the plan. ",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1474925826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1475522025",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1475522025",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1475522025,
    "node_id": "IC_kwDOAQXtWs5X8q3p",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T02:30:24Z",
    "updated_at": "2023-03-20T02:30:24Z",
    "author_association": "MEMBER",
    "body": "> Can you please explain more on scenarios when rebalancepartitions becomes child of locallimit? i tried SELECT * FROM t WHERE id > 1 LIMIT 5; with spark 2.4.4 version and rebalancepartitions is not part of the plan.\r\n\r\nSpark 2.4.4  does not have `RebalancePartitions`. Please see: https://issues.apache.org/jira/browse/SPARK-35786",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1475522025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1479847214",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1479847214",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1479847214,
    "node_id": "IC_kwDOAQXtWs5YNK0u",
    "user": {
      "login": "VindhyaG",
      "id": 15109987,
      "node_id": "MDQ6VXNlcjE1MTA5OTg3",
      "avatar_url": "https://avatars.githubusercontent.com/u/15109987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/VindhyaG",
      "html_url": "https://github.com/VindhyaG",
      "followers_url": "https://api.github.com/users/VindhyaG/followers",
      "following_url": "https://api.github.com/users/VindhyaG/following{/other_user}",
      "gists_url": "https://api.github.com/users/VindhyaG/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/VindhyaG/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/VindhyaG/subscriptions",
      "organizations_url": "https://api.github.com/users/VindhyaG/orgs",
      "repos_url": "https://api.github.com/users/VindhyaG/repos",
      "events_url": "https://api.github.com/users/VindhyaG/events{/privacy}",
      "received_events_url": "https://api.github.com/users/VindhyaG/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-22T16:02:20Z",
    "updated_at": "2023-03-22T16:02:20Z",
    "author_association": "NONE",
    "body": "> > Can you please explain more on scenarios when rebalancepartitions becomes child of locallimit? i tried SELECT * FROM t WHERE id > 1 LIMIT 5; with spark 2.4.4 version and rebalancepartitions is not part of the plan.\r\n> \r\n> Spark 2.4.4 does not have `RebalancePartitions`. Please see: https://issues.apache.org/jira/browse/SPARK-35786\r\nGot it.thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1479847214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1479987729",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1479987729",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1479987729,
    "node_id": "IC_kwDOAQXtWs5YNtIR",
    "user": {
      "login": "dongjoon-hyun",
      "id": 9700541,
      "node_id": "MDQ6VXNlcjk3MDA1NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongjoon-hyun",
      "html_url": "https://github.com/dongjoon-hyun",
      "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
      "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
      "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
      "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
      "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-22T17:32:15Z",
    "updated_at": "2023-03-22T17:32:15Z",
    "author_association": "MEMBER",
    "body": "Merged to master for Apache Spark 3.5.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1479987729/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1482318942",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1482318942",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1482318942,
    "node_id": "IC_kwDOAQXtWs5YWmRe",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-24T06:31:46Z",
    "updated_at": "2023-03-24T06:31:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't quite get the rationale. For `SELECT /*+ REBALANCE */ * FROM t WHERE id > 1 LIMIT 5;`, the user explicitly requires to do a rebalance before limit, why do we remove it? It's a physical hint and we should respect it.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1482318942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1484408565",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1484408565",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1484408565,
    "node_id": "IC_kwDOAQXtWs5Yekb1",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T02:59:11Z",
    "updated_at": "2023-03-27T02:59:11Z",
    "author_association": "MEMBER",
    "body": "rebalance before limit feels meaningless.\r\nIf the user really wants to take n rows from each partition, the SQL should look like this:\r\n```sql\r\nSELECT *\r\nFROM   (SELECT *,\r\n               Row_number() OVER(partition BY pmod(Hash(id, 42), 200) ORDER BY id) AS rn\r\n        FROM   tbl)\r\nWHERE  rn <= 5;\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1484408565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1484415289",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1484415289",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1484415289,
    "node_id": "IC_kwDOAQXtWs5YemE5",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T03:06:51Z",
    "updated_at": "2023-03-27T03:06:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "The optimizer can remove meanless logical operators as it won't change the query result and it's usually more efficient to remove operators. But for physical APIs like rebalance and repartition, the users explicitly ask to take control of performance tuning and we should trust them. Besides, I don't think this is an always-beneficial optimization, what if the limit is very large? We should let the user make the decision: they can remove the rebalance hint if they believe it makes the perf worse.  What do you think? @wangyum @dongjoon-hyun ",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1484415289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1484592416",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1484592416",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1484592416,
    "node_id": "IC_kwDOAQXtWs5YfRUg",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T06:47:20Z",
    "updated_at": "2023-03-27T06:47:20Z",
    "author_association": "MEMBER",
    "body": "Could we push the `LocalLimit` through `RebalancePartitions`?\r\n```\r\n== Optimized Logical Plan ==\r\nGlobalLimit 5\r\n+- LocalLimit 5\r\n   +- RebalancePartitions\r\n      +- LocalLimit 5\r\n         +- Filter (isnotnull(id#0L) AND (id#0L > 1))\r\n            +- Relation spark_catalog.default.tbl[id#0L] parquet\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1484592416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1484657163",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1484657163",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1484657163,
    "node_id": "IC_kwDOAQXtWs5YfhIL",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T07:41:58Z",
    "updated_at": "2023-03-27T07:41:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't think so. Local limit is per partition and rebalance changes partitioning.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1484657163/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1484659332",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1484659332",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1484659332,
    "node_id": "IC_kwDOAQXtWs5YfhqE",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T07:43:55Z",
    "updated_at": "2023-03-27T07:43:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "oh wait, I thought the hint applies as the last operator. `SELECT /*+ REBALANCE */ * FROM t WHERE id > 1 LIMIT 5;` should rebalance be the root node for this query?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1484659332/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1485539305",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1485539305",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1485539305,
    "node_id": "IC_kwDOAQXtWs5Yi4fp",
    "user": {
      "login": "dongjoon-hyun",
      "id": 9700541,
      "node_id": "MDQ6VXNlcjk3MDA1NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongjoon-hyun",
      "html_url": "https://github.com/dongjoon-hyun",
      "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
      "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
      "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
      "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
      "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T17:20:36Z",
    "updated_at": "2023-03-27T18:39:29Z",
    "author_association": "MEMBER",
    "body": "`HINT` is a part of `selectClause`.\r\nhttps://github.com/apache/spark/blob/a3d9e0ae0f95a55766078da5d0bf0f74f3c3cfc3/sql/catalyst/src/main/antlr4/org/apache/spark/sql/catalyst/parser/SqlBaseParser.g4#L530-L532\r\n\r\nThat's the reason why `LIMIT` is the root of the query.\r\n```\r\nscala> sql(\"SELECT /*+ REBALANCE */ * FROM t WHERE id > 1 LIMIT 5\").explain(true)\r\n== Parsed Logical Plan ==\r\n'GlobalLimit 5\r\n+- 'LocalLimit 5\r\n   +- 'UnresolvedHint REBALANCE\r\n      +- 'Project [*]\r\n         +- 'Filter ('id > 1)\r\n            +- 'UnresolvedRelation [t], [], false\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1485539305/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1486144770",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1486144770",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1486144770,
    "node_id": "IC_kwDOAQXtWs5YlMUC",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T03:17:26Z",
    "updated_at": "2023-03-28T03:17:26Z",
    "author_association": "MEMBER",
    "body": "If such queries cannot be optimized, the performance of such queries will be very poor. We use a partition to fetch data from MySQL, and increase its parallelism for downstream computing after fetching the data:\r\n\r\n```sql\r\nCREATE VIEW full_query_log\r\nAS\r\nSELECT h.* FROM query_log_hdfs h\r\nUNION ALL\r\nSELECT /*+ REBALANCE */ q.*, DATE(start) FROM query_log_mysql q;\r\n\r\nSELECT * FROM full_query_log limit 5;\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1486144770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1486163555",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1486163555",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1486163555,
    "node_id": "IC_kwDOAQXtWs5YlQ5j",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T03:50:57Z",
    "updated_at": "2023-03-28T03:50:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK now I got the use case. At the time when we add the rebalance hint, we don't know what the final query is. Shall we make this optimization a bit more conservative to match both global and local limit? I still think it's risky to remove rebalance below local limit.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1486163555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1486832610",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1486832610",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1486832610,
    "node_id": "IC_kwDOAQXtWs5Yn0Pi",
    "user": {
      "login": "dongjoon-hyun",
      "id": 9700541,
      "node_id": "MDQ6VXNlcjk3MDA1NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongjoon-hyun",
      "html_url": "https://github.com/dongjoon-hyun",
      "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
      "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
      "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
      "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
      "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T12:52:24Z",
    "updated_at": "2023-03-28T12:52:24Z",
    "author_association": "MEMBER",
    "body": "+1 for @cloud-fan 's suggestion.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1486832610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1486833076",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1486833076",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1486833076,
    "node_id": "IC_kwDOAQXtWs5Yn0W0",
    "user": {
      "login": "dongjoon-hyun",
      "id": 9700541,
      "node_id": "MDQ6VXNlcjk3MDA1NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongjoon-hyun",
      "html_url": "https://github.com/dongjoon-hyun",
      "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
      "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
      "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
      "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
      "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T12:52:43Z",
    "updated_at": "2023-03-28T12:52:43Z",
    "author_association": "MEMBER",
    "body": "Could you make a follow-up, @wangyum ?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1486833076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1487849388",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1487849388",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1487849388,
    "node_id": "IC_kwDOAQXtWs5Yrses",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T02:12:19Z",
    "updated_at": "2023-03-29T02:12:19Z",
    "author_association": "MEMBER",
    "body": "How about reverting this PR directly? Otherwise, we need to change `LimitPushDown`, which is not elegant:\r\n```scala\r\ncase Limit(exp, u: Union) if u.children.exists(_.isInstanceOf[HasPartitionExpressions]) =>\r\n  val newChildren = u.children.map {\r\n    case r: RebalancePartitions =>\r\n      maybePushLocalLimit(exp, r.child)\r\n    case r: RepartitionByExpression\r\n        if r.partitionExpressions.nonEmpty && r.partitionExpressions.forall(_.deterministic) =>\r\n      maybePushLocalLimit(exp, r.child)\r\n    case o =>\r\n      maybePushLocalLimit(exp, o)\r\n  }\r\n  Limit(exp, u.copy(children = newChildren))\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1487849388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1487859134",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1487859134",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1487859134,
    "node_id": "IC_kwDOAQXtWs5Yru2-",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T02:28:54Z",
    "updated_at": "2023-03-29T02:28:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "why do we need to change `LimitPushDown`? We can't push limit through repartition.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1487859134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1487867844",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1487867844",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1487867844,
    "node_id": "IC_kwDOAQXtWs5Yrw_E",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T02:41:48Z",
    "updated_at": "2023-03-29T02:41:48Z",
    "author_association": "MEMBER",
    "body": "It is meaningless to only optimize this case, because the user can manually remove the hint:\r\n```sql\r\nSELECT /*+ REBALANCE */ * FROM tbl LIMIT 5;\r\n```\r\n\r\nI'd like to optimize this case, since the user cannot manually remove the hint, because the view may be maintained by others:\r\n```sql\r\nCREATE VIEW full_query_log\r\nAS\r\nSELECT h.* FROM query_log_hdfs h\r\nUNION ALL\r\nSELECT /*+ REBALANCE */ q.*, DATE(start) FROM query_log_mysql q;\r\n\r\nSELECT * FROM full_query_log limit 5;\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1487867844/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1487993457",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1487993457",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1487993457,
    "node_id": "IC_kwDOAQXtWs5YsPpx",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T06:02:28Z",
    "updated_at": "2023-03-29T06:02:28Z",
    "author_association": "MEMBER",
    "body": "Reverted this commit: https://github.com/apache/spark/commit/58facc16536cb2784aace38d6cca77bd055a3053.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1487993457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1487995895",
    "html_url": "https://github.com/apache/spark/pull/40462#issuecomment-1487995895",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40462",
    "id": 1487995895,
    "node_id": "IC_kwDOAQXtWs5YsQP3",
    "user": {
      "login": "dongjoon-hyun",
      "id": 9700541,
      "node_id": "MDQ6VXNlcjk3MDA1NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongjoon-hyun",
      "html_url": "https://github.com/dongjoon-hyun",
      "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
      "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
      "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
      "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
      "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T06:05:10Z",
    "updated_at": "2023-03-29T06:05:10Z",
    "author_association": "MEMBER",
    "body": "Thank you for the decision, @wangyum .",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1487995895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
