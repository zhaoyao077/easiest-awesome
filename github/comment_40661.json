[
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1534242428",
    "html_url": "https://github.com/apache/spark/pull/40661#issuecomment-1534242428",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40661",
    "id": 1534242428,
    "node_id": "IC_kwDOAQXtWs5bcq58",
    "user": {
      "login": "beliefer",
      "id": 8486025,
      "node_id": "MDQ6VXNlcjg0ODYwMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8486025?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/beliefer",
      "html_url": "https://github.com/beliefer",
      "followers_url": "https://api.github.com/users/beliefer/followers",
      "following_url": "https://api.github.com/users/beliefer/following{/other_user}",
      "gists_url": "https://api.github.com/users/beliefer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/beliefer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/beliefer/subscriptions",
      "organizations_url": "https://api.github.com/users/beliefer/orgs",
      "repos_url": "https://api.github.com/users/beliefer/repos",
      "events_url": "https://api.github.com/users/beliefer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/beliefer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T07:50:07Z",
    "updated_at": "2023-05-04T07:50:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "ping @cloud-fan ",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1534242428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1534274671",
    "html_url": "https://github.com/apache/spark/pull/40661#issuecomment-1534274671",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40661",
    "id": 1534274671,
    "node_id": "IC_kwDOAQXtWs5bcyxv",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T08:16:24Z",
    "updated_at": "2023-05-04T08:16:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think @peter-toth did something similar before, can you share some ideas @peter-toth ?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1534274671/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1534538671",
    "html_url": "https://github.com/apache/spark/pull/40661#issuecomment-1534538671",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40661",
    "id": 1534538671,
    "node_id": "IC_kwDOAQXtWs5bdzOv",
    "user": {
      "login": "beliefer",
      "id": 8486025,
      "node_id": "MDQ6VXNlcjg0ODYwMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8486025?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/beliefer",
      "html_url": "https://github.com/beliefer",
      "followers_url": "https://api.github.com/users/beliefer/followers",
      "following_url": "https://api.github.com/users/beliefer/following{/other_user}",
      "gists_url": "https://api.github.com/users/beliefer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/beliefer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/beliefer/subscriptions",
      "organizations_url": "https://api.github.com/users/beliefer/orgs",
      "repos_url": "https://api.github.com/users/beliefer/repos",
      "events_url": "https://api.github.com/users/beliefer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/beliefer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T10:47:43Z",
    "updated_at": "2023-05-04T10:47:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I think @peter-toth did something similar before, can you share some ideas @peter-toth ?\r\n\r\nI guess @peter-toth did the similar thing for scalar subquery, but this one try to fix non-scalar subquery.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1534538671/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1536035613",
    "html_url": "https://github.com/apache/spark/pull/40661#issuecomment-1536035613",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40661",
    "id": 1536035613,
    "node_id": "IC_kwDOAQXtWs5bjgsd",
    "user": {
      "login": "peter-toth",
      "id": 7253827,
      "node_id": "MDQ6VXNlcjcyNTM4Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7253827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/peter-toth",
      "html_url": "https://github.com/peter-toth",
      "followers_url": "https://api.github.com/users/peter-toth/followers",
      "following_url": "https://api.github.com/users/peter-toth/following{/other_user}",
      "gists_url": "https://api.github.com/users/peter-toth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/peter-toth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/peter-toth/subscriptions",
      "organizations_url": "https://api.github.com/users/peter-toth/orgs",
      "repos_url": "https://api.github.com/users/peter-toth/repos",
      "events_url": "https://api.github.com/users/peter-toth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/peter-toth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T10:12:32Z",
    "updated_at": "2023-05-05T10:21:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > I think @peter-toth did something similar before, can you share some ideas @peter-toth ?\r\n> \r\n> I guess @peter-toth did the similar thing for scalar subquery, but this one try to fix non-scalar subquery.\r\n\r\nSorry, I haven't got time to fully review the PR (maybe next week) but at first sight it seems to copy some fuctions (e.g. `checkIdenticalPlans()`, `mergeNamedExpressions()`) from `MergeScalarSubqueries` so there seems to be some room for improvement and we could share the common functions. Also, some names (e.g. `subqueryIndex`) might need some changes here.\r\n\r\nThis PR combines UNION ALL legs if they return disjoint set of rows from the same source node. I think this makes sense in those cases when there are overlaping scans in the legs (despite the disjoint filters), and by \"overlapping\" I mean that the scans use some common set of files.\r\nSo seems like the only case when this change doesn't bring improvement is when the filter is a pushed-down partitioning/bucketing column filter and the scans in union legs doesn't overlap. But even in that case I'm not sure if this PR has any disadvantage, just doesn't improve anything...\r\n\r\nBTW, `MergeScalarSubqueries` (https://github.com/apache/spark/pull/32298) does very similar merging, but we run that only once because merging can be costly when there are many candidates. Do we need `EliminateUnions` in `operatorOptimizationBatch`?\r\nSidenote: `MergeScalarSubqueries` doesn't work with different filters currently. This is because merging filters in subqueries is more comlicated as we need to propogate the filters up to an aggregate, and because it can cause performance degradation when we have non-overlapping scans. (See this WIP PR: https://github.com/apache/spark/pull/37630).",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1536035613/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1536060234",
    "html_url": "https://github.com/apache/spark/pull/40661#issuecomment-1536060234",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40661",
    "id": 1536060234,
    "node_id": "IC_kwDOAQXtWs5bjmtK",
    "user": {
      "login": "beliefer",
      "id": 8486025,
      "node_id": "MDQ6VXNlcjg0ODYwMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8486025?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/beliefer",
      "html_url": "https://github.com/beliefer",
      "followers_url": "https://api.github.com/users/beliefer/followers",
      "following_url": "https://api.github.com/users/beliefer/following{/other_user}",
      "gists_url": "https://api.github.com/users/beliefer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/beliefer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/beliefer/subscriptions",
      "organizations_url": "https://api.github.com/users/beliefer/orgs",
      "repos_url": "https://api.github.com/users/beliefer/repos",
      "events_url": "https://api.github.com/users/beliefer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/beliefer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T10:36:48Z",
    "updated_at": "2023-05-05T10:36:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "@peter-toth Thank you for your first look.\r\nIn fact, this PR references some functions as you mentioned above (e.g. `checkIdenticalPlans`). If we can share these functions, that be good.\r\n\r\nThe partitioning/bucketing column filter seems doesn't improve anything. I will optimize it in further.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1536060234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
