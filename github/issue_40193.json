{
  "url": "https://api.github.com/repos/apache/spark/issues/40193",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/40193/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/40193/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/40193/events",
  "html_url": "https://github.com/apache/spark/pull/40193",
  "id": 1600865055,
  "node_id": "PR_kwDOAQXtWs5K0K82",
  "number": 40193,
  "title": "[SPARK-42528] Optimize PercentileHeap further by removing averaging",
  "user": {
    "login": "alkis",
    "id": 265981,
    "node_id": "MDQ6VXNlcjI2NTk4MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/265981?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alkis",
    "html_url": "https://github.com/alkis",
    "followers_url": "https://api.github.com/users/alkis/followers",
    "following_url": "https://api.github.com/users/alkis/following{/other_user}",
    "gists_url": "https://api.github.com/users/alkis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alkis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alkis/subscriptions",
    "organizations_url": "https://api.github.com/users/alkis/orgs",
    "repos_url": "https://api.github.com/users/alkis/repos",
    "events_url": "https://api.github.com/users/alkis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alkis/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1981527456,
      "node_id": "MDU6TGFiZWwxOTgxNTI3NDU2",
      "url": "https://api.github.com/repos/apache/spark/labels/CORE",
      "name": "CORE",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-02-27T10:06:12Z",
  "updated_at": "2023-02-28T07:46:48Z",
  "closed_at": "2023-02-28T07:46:48Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/40193",
    "html_url": "https://github.com/apache/spark/pull/40193",
    "diff_url": "https://github.com/apache/spark/pull/40193.diff",
    "patch_url": "https://github.com/apache/spark/pull/40193.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\n\r\nRemove the averaging in the case the number of elements in the heap is even. Always return the number from the large heap which matches what we would do if we sorted an array and returned the N'th element where `N = (percentage * num_elements).toInt`.\r\n\r\nBoth approaches are valid in terms of computing quantiles. For the purpose that PercentileHeap is used today both work just as well, except the version proposed in this PR is 30% faster (or put differently the version in master now is 50% slower than the version in this PR):\r\n\r\n```\r\nbefore\r\n58 ns per op on heaps of size 1000\r\n\r\nafter\r\n40 ns per op on heaps of size 1000\r\n```\r\n\r\nGiven that scheduler is performance sensitive on scheduling decisions it is best if we pick the fastest implementation.\r\n\r\n### Why are the changes needed?\r\n\r\nSee above.\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nNo.\r\n\r\n### How was this patch tested?\r\nExisting tests and benchmark.\r\n",
  "closed_by": {
    "login": "cloud-fan",
    "id": 3182036,
    "node_id": "MDQ6VXNlcjMxODIwMzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cloud-fan",
    "html_url": "https://github.com/cloud-fan",
    "followers_url": "https://api.github.com/users/cloud-fan/followers",
    "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
    "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
    "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
    "repos_url": "https://api.github.com/users/cloud-fan/repos",
    "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/40193/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/40193/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
