{
  "url": "https://api.github.com/repos/apache/spark/issues/40395",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/40395/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/40395/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/40395/events",
  "html_url": "https://github.com/apache/spark/pull/40395",
  "id": 1621090468,
  "node_id": "PR_kwDOAQXtWs5L33zl",
  "number": 40395,
  "title": "[SPARK-42770][CONNECT] Add `truncatedTo(ChronoUnit.MICROS)` to make `SQLImplicitsTestSuite`  in Java 17 daily test GA task pass",
  "user": {
    "login": "LuciferYang",
    "id": 1475305,
    "node_id": "MDQ6VXNlcjE0NzUzMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1475305?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LuciferYang",
    "html_url": "https://github.com/LuciferYang",
    "followers_url": "https://api.github.com/users/LuciferYang/followers",
    "following_url": "https://api.github.com/users/LuciferYang/following{/other_user}",
    "gists_url": "https://api.github.com/users/LuciferYang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LuciferYang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LuciferYang/subscriptions",
    "organizations_url": "https://api.github.com/users/LuciferYang/orgs",
    "repos_url": "https://api.github.com/users/LuciferYang/repos",
    "events_url": "https://api.github.com/users/LuciferYang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LuciferYang/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1405794576,
      "node_id": "MDU6TGFiZWwxNDA1Nzk0NTc2",
      "url": "https://api.github.com/repos/apache/spark/labels/SQL",
      "name": "SQL",
      "color": "ededed",
      "default": false,
      "description": null
    },
    {
      "id": 4556440342,
      "node_id": "LA_kwDOAQXtWs8AAAABD5XDFg",
      "url": "https://api.github.com/repos/apache/spark/labels/CONNECT",
      "name": "CONNECT",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-03-13T09:37:31Z",
  "updated_at": "2023-03-15T17:14:40Z",
  "closed_at": "2023-03-14T15:53:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/40395",
    "html_url": "https://github.com/apache/spark/pull/40395",
    "diff_url": "https://github.com/apache/spark/pull/40395.diff",
    "patch_url": "https://github.com/apache/spark/pull/40395.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\nRun `LocalDateTime.now()` and `Instant.now()` with Java 8 & 11 always get microseconds on both Linux and MacOS, but there are some differences when using Java 17, it will get accurate nanoseconds on Linux, but still get the microseconds on MacOS. \r\n\r\nOn Linux(CentOs)\r\n\r\n```\r\njshell> java.time.LocalDateTime.now()\r\n$1 ==> 2023-03-13T18:09:12.498162194\r\n\r\njshell> java.time.Instant.now()\r\n$2 ==> 2023-03-13T10:09:16.013993186Z\r\n```\r\n\r\nOn MacOS\r\n\r\n```\r\njshell> java.time.LocalDateTime.now()\r\n$1 ==> 2023-03-13T17:13:47.485897\r\n\r\njshell> java.time.Instant.now()\r\n$2 ==> 2023-03-13T09:15:12.031850Z\r\n```\r\n \r\nAt present, Spark always converts them to microseconds, this will cause `test implicit encoder resolution` in SQLImplicitsTestSuite test fail when using Java 17 on Linux, so this pr add `truncatedTo(ChronoUnit.MICROS)` when\r\ntesting on Linux using Java 17 to ensure the accuracy of test input data is also microseconds.\r\n\r\n\r\n### Why are the changes needed?\r\nMake Java 17 daily test GA task run successfully. The Java 17 daily test GA task failed as follows:\r\n\r\n```\r\n[info] - test implicit encoder resolution *** FAILED *** (1 second, 329 milliseconds)\r\n4429[info]   2023-03-02T23:00:20.404434 did not equal 2023-03-02T23:00:20.404434875 (SQLImplicitsTestSuite.scala:63)\r\n4430[info]   org.scalatest.exceptions.TestFailedException:\r\n4431[info]   at org.scalatest.Assertions.newAssertionFailedException(Assertions.scala:472)\r\n4432[info]   at org.scalatest.Assertions.newAssertionFailedException$(Assertions.scala:471)\r\n4433[info]   at org.scalatest.Assertions$.newAssertionFailedException(Assertions.scala:1231)\r\n4434[info]   at org.scalatest.Assertions$AssertionsHelper.macroAssert(Assertions.scala:1295)\r\n4435[info]   at org.apache.spark.sql.SQLImplicitsTestSuite.testImplicit$1(SQLImplicitsTestSuite.scala:63)\r\n4436[info]   at org.apache.spark.sql.SQLImplicitsTestSuite.$anonfun$new$2(SQLImplicitsTestSuite.scala:133)\r\n```\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nNo\r\n\r\n\r\n### How was this patch tested?\r\nManual checked with Java 17\r\n",
  "closed_by": {
    "login": "dongjoon-hyun",
    "id": 9700541,
    "node_id": "MDQ6VXNlcjk3MDA1NDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dongjoon-hyun",
    "html_url": "https://github.com/dongjoon-hyun",
    "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
    "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
    "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
    "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
    "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
    "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/40395/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/40395/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
