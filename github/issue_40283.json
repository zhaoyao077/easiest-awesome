{
  "url": "https://api.github.com/repos/apache/spark/issues/40283",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/40283/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/40283/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/40283/events",
  "html_url": "https://github.com/apache/spark/pull/40283",
  "id": 1610103407,
  "node_id": "PR_kwDOAQXtWs5LTO11",
  "number": 40283,
  "title": "[SPARK-42673][BUILD]  Make `build/mvn` build Spark only with the verified maven version",
  "user": {
    "login": "LuciferYang",
    "id": 1475305,
    "node_id": "MDQ6VXNlcjE0NzUzMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1475305?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LuciferYang",
    "html_url": "https://github.com/LuciferYang",
    "followers_url": "https://api.github.com/users/LuciferYang/followers",
    "following_url": "https://api.github.com/users/LuciferYang/following{/other_user}",
    "gists_url": "https://api.github.com/users/LuciferYang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LuciferYang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LuciferYang/subscriptions",
    "organizations_url": "https://api.github.com/users/LuciferYang/orgs",
    "repos_url": "https://api.github.com/users/LuciferYang/repos",
    "events_url": "https://api.github.com/users/LuciferYang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LuciferYang/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1406627200,
      "node_id": "MDU6TGFiZWwxNDA2NjI3MjAw",
      "url": "https://api.github.com/repos/apache/spark/labels/BUILD",
      "name": "BUILD",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2023-03-05T08:23:49Z",
  "updated_at": "2023-03-07T03:18:41Z",
  "closed_at": "2023-03-06T19:06:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/40283",
    "html_url": "https://github.com/apache/spark/pull/40283",
    "diff_url": "https://github.com/apache/spark/pull/40283.diff",
    "patch_url": "https://github.com/apache/spark/pull/40283.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\n`build/mvn` tends to use the new maven version to build Spark now, and GA starts to use 3.9.0 as the default maven version.\r\n\r\nBut there may be some uncertain factors when building Spark with unverified version.\r\n\r\nFor example, `java-11-17` GA build task build with maven 3.9.0 has many error logs in master like follow:\r\n\r\n\r\n```\r\nError: [ERROR] An error occurred attempting to read POM\r\norg.codehaus.plexus.util.xml.pull.XmlPullParserException: UTF-8 BOM plus xml decl of ISO-8859-1 is incompatible (position: START_DOCUMENT seen <?xml version=\"1.0\" encoding=\"ISO-8859-1\"... @1:42) \r\n    at org.codehaus.plexus.util.xml.pull.MXParser.parseXmlDeclWithVersion (MXParser.java:3423)\r\n    at org.codehaus.plexus.util.xml.pull.MXParser.parseXmlDecl (MXParser.java:3345)\r\n    at org.codehaus.plexus.util.xml.pull.MXParser.parsePI (MXParser.java:3197)\r\n    at org.codehaus.plexus.util.xml.pull.MXParser.parseProlog (MXParser.java:1828)\r\n    at org.codehaus.plexus.util.xml.pull.MXParser.nextImpl (MXParser.java:1757)\r\n    at org.codehaus.plexus.util.xml.pull.MXParser.next (MXParser.java:1375)\r\n    at org.apache.maven.model.io.xpp3.MavenXpp3Reader.read (MavenXpp3Reader.java:3940)\r\n    at org.apache.maven.model.io.xpp3.MavenXpp3Reader.read (MavenXpp3Reader.java:612)\r\n    at org.apache.maven.model.io.xpp3.MavenXpp3Reader.read (MavenXpp3Reader.java:627)\r\n    at org.cyclonedx.maven.BaseCycloneDxMojo.readPom (BaseCycloneDxMojo.java:759)\r\n    at org.cyclonedx.maven.BaseCycloneDxMojo.readPom (BaseCycloneDxMojo.java:746)\r\n    at org.cyclonedx.maven.BaseCycloneDxMojo.retrieveParentProject (BaseCycloneDxMojo.java:694)\r\n    at org.cyclonedx.maven.BaseCycloneDxMojo.getClosestMetadata (BaseCycloneDxMojo.java:524)\r\n    at org.cyclonedx.maven.BaseCycloneDxMojo.convert (BaseCycloneDxMojo.java:481)\r\n    at org.cyclonedx.maven.CycloneDxMojo.execute (CycloneDxMojo.java:70)\r\n    at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo (DefaultBuildPluginManager.java:126)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor.doExecute2 (MojoExecutor.java:342)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor.doExecute (MojoExecutor.java:330)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:213)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:175)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor.access$000 (MojoExecutor.java:76)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor$1.run (MojoExecutor.java:163)\r\n    at org.apache.maven.plugin.DefaultMojosExecutionStrategy.execute (DefaultMojosExecutionStrategy.java:39)\r\n    at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:160)\r\n    at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject (LifecycleModuleBuilder.java:105)\r\n    at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject (LifecycleModuleBuilder.java:73)\r\n    at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build (SingleThreadedBuilder.java:53)\r\n    at org.apache.maven.lifecycle.internal.LifecycleStarter.execute (LifecycleStarter.java:118)\r\n    at org.apache.maven.DefaultMaven.doExecute (DefaultMaven.java:260)\r\n    at org.apache.maven.DefaultMaven.doExecute (DefaultMaven.java:172)\r\n    at org.apache.maven.DefaultMaven.execute (DefaultMaven.java:100)\r\n    at org.apache.maven.cli.MavenCli.execute (MavenCli.java:821)\r\n    at org.apache.maven.cli.MavenCli.doMain (MavenCli.java:270)\r\n    at org.apache.maven.cli.MavenCli.main (MavenCli.java:192)\r\n    at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0 (Native Method)\r\n    at jdk.internal.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:77)\r\n    at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:43)\r\n    at java.lang.reflect.Method.invoke (Method.java:568)\r\n    at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced (Launcher.java:282)\r\n    at org.codehaus.plexus.classworlds.launcher.Launcher.launch (Launcher.java:225)\r\n    at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode (Launcher.java:406)\r\n    at org.codehaus.plexus.classworlds.launcher.Launcher.main (Launcher.java:347)\r\n```\r\n\r\nSo this pr change the version check condition of `build/mvn` to make it build Spark only with the verified maven version.\r\n\r\n### Why are the changes needed?\r\nMake `build/mvn` build Spark only with the verified maven version\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nNo\r\n\r\n\r\n### How was this patch tested?\r\n\r\n- `java-11-17` GA build task pass and no error message as above\r\n- Manual test:\r\n\r\n1. Make the system use maven 3.9.0( > 3.8.7 ) by default:\r\n\r\nrun `mvn -version`\r\n\r\n```\r\nApache Maven 3.9.0 (9b58d2bad23a66be161c4664ef21ce219c2c8584)\r\nMaven home: /Users/${userName}/Tools/maven\r\nJava version: 1.8.0_362, vendor: Azul Systems, Inc., runtime: /Users/${userName}/Tools/zulu8/zulu-8.jdk/Contents/Home/jre\r\nDefault locale: zh_CN, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"13.2.1\", arch: \"aarch64\", family: \"mac\"\r\n```\r\n\r\nand run `build/mvn -version`\r\n\r\n```\r\nUsing `mvn` from path: /${basedir}/spark/build/apache-maven-3.8.7/bin/mvn\r\nUsing SPARK_LOCAL_IP=localhost\r\nApache Maven 3.8.7 (b89d5959fcde851dcb1c8946a785a163f14e1e29)\r\nMaven home: /${basedir}/spark/build/apache-maven-3.8.7\r\nJava version: 1.8.0_362, vendor: Azul Systems, Inc., runtime: /Users/${userName}/Tools/zulu8/zulu-8.jdk/Contents/Home/jre\r\nDefault locale: zh_CN, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"13.2.1\", arch: \"aarch64\", family: \"mac\"\r\n```\r\n \r\nWe can see Spark use 3.8.7 in build directory when the system default maven > 3.8.7\r\n\r\n2. Make the system use maven 3.8.7 by default:\r\n\r\nrun `mvn -version`\r\n\r\n```\r\nmvn -version\r\nApache Maven 3.8.7 (b89d5959fcde851dcb1c8946a785a163f14e1e29)\r\nMaven home: /Users/${userName}/Tools/maven\r\nJava version: 1.8.0_362, vendor: Azul Systems, Inc., runtime: /Users/${userName}/Tools/zulu8/zulu-8.jdk/Contents/Home/jre\r\nDefault locale: zh_CN, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"13.2.1\", arch: \"aarch64\", family: \"mac\"\r\n```\r\n\r\nand run `build/mvn -version`\r\n\r\n```\r\nUsing `mvn` from path: /Users/${userName}/Tools/maven/bin/mvn\r\nUsing SPARK_LOCAL_IP=localhost\r\nApache Maven 3.8.7 (b89d5959fcde851dcb1c8946a785a163f14e1e29)\r\nMaven home: /Users/${userName}/Tools/maven\r\nJava version: 1.8.0_362, vendor: Azul Systems, Inc., runtime: /Users/${userName}/Tools/zulu8/zulu-8.jdk/Contents/Home/jre\r\nDefault locale: zh_CN, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"13.2.1\", arch: \"aarch64\", family: \"mac\"\r\n```\r\n \r\nWe can see Spark use system default maven 3.8.7 when the system default maven is 3.8.7.\r\n\r\n\r\n3. Make the system use maven 3.8.6( < 3.8.7 ) by default:\r\n\r\nrun `mvn -version`\r\n\r\n```\r\nmvn -version\r\nApache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)\r\nMaven home: /Users/${userName}/Tools/maven\r\nJava version: 1.8.0_362, vendor: Azul Systems, Inc., runtime: /Users/${userName}/Tools/zulu8/zulu-8.jdk/Contents/Home/jre\r\nDefault locale: zh_CN, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"13.2.1\", arch: \"aarch64\", family: \"mac\"\r\n```\r\n\r\nand run `build/mvn -version`\r\n\r\n```\r\nUsing `mvn` from path: /Users/${userName}/Tools/maven/bin/mvn\r\nUsing SPARK_LOCAL_IP=localhost\r\nApache Maven 3.8.7 (b89d5959fcde851dcb1c8946a785a163f14e1e29)\r\nMaven home: /Users/${userName}/Tools/maven\r\nJava version: 1.8.0_362, vendor: Azul Systems, Inc., runtime: /Users/${userName}/Tools/zulu8/zulu-8.jdk/Contents/Home/jre\r\nDefault locale: zh_CN, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"13.2.1\", arch: \"aarch64\", family: \"mac\"\r\n```\r\n \r\nWe can see Spark use 3.8.7 in build directory when the system default maven < 3.8.7.\r\n",
  "closed_by": {
    "login": "dongjoon-hyun",
    "id": 9700541,
    "node_id": "MDQ6VXNlcjk3MDA1NDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dongjoon-hyun",
    "html_url": "https://github.com/dongjoon-hyun",
    "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
    "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
    "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
    "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
    "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
    "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/40283/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/40283/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
