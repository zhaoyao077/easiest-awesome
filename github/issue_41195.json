{
  "url": "https://api.github.com/repos/apache/spark/issues/41195",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/41195/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/41195/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/41195/events",
  "html_url": "https://github.com/apache/spark/pull/41195",
  "id": 1713332301,
  "node_id": "PR_kwDOAQXtWs5Qry1A",
  "number": 41195,
  "title": "[SPARK-43534][BUILD] Add log4j-1.2-api and log4j-slf4j2-impl to classpath if active hadoop-provided",
  "user": {
    "login": "wangyum",
    "id": 5399861,
    "node_id": "MDQ6VXNlcjUzOTk4NjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wangyum",
    "html_url": "https://github.com/wangyum",
    "followers_url": "https://api.github.com/users/wangyum/followers",
    "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
    "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
    "organizations_url": "https://api.github.com/users/wangyum/orgs",
    "repos_url": "https://api.github.com/users/wangyum/repos",
    "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wangyum/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1406627200,
      "node_id": "MDU6TGFiZWwxNDA2NjI3MjAw",
      "url": "https://api.github.com/repos/apache/spark/labels/BUILD",
      "name": "BUILD",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2023-05-17T07:48:19Z",
  "updated_at": "2023-05-20T23:45:29Z",
  "closed_at": "2023-05-20T23:45:29Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/41195",
    "html_url": "https://github.com/apache/spark/pull/41195",
    "diff_url": "https://github.com/apache/spark/pull/41195.diff",
    "patch_url": "https://github.com/apache/spark/pull/41195.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\n\r\nThis PR adds `log4j-1.2-api` and `log4j-slf4j2-impl` to classpath if active `hadoop-provided`.\r\n\r\n### Why are the changes needed?\r\n\r\nTo fix log issue.\r\n\r\nHow to reproduce this issue:\r\n1. Build Spark:\r\n   ```\r\n   ./dev/make-distribution.sh --name provided --tgz -Phive -Phive-thriftserver -Pyarn -Phadoop-provided\r\n   tar -zxf spark-3.5.0-SNAPSHOT-bin-provided.tgz \r\n   ```\r\n2. Copy the following jars to spark-3.5.0-SNAPSHOT-bin-provided/jars:\r\n   ```\r\n   guava-14.0.1.jar\r\n   hadoop-client-api-3.3.5.jar\r\n   hadoop-client-runtime-3.3.5.jar\r\n   hadoop-shaded-guava-1.1.1.jar\r\n   hadoop-yarn-server-web-proxy-3.3.5.jar\r\n   slf4j-api-2.0.7.jar\r\n   ```\r\n3. Add a new log4j2.properties to spark-3.5.0-SNAPSHOT-bin-provided/conf:\r\n   ```\r\n   rootLogger.level = info\r\n   rootLogger.appenderRef.file.ref = File\r\n   rootLogger.appenderRef.stderr.ref = console\r\n   \r\n   appender.console.type = Console\r\n   appender.console.name = console\r\n   appender.console.target = SYSTEM_ERR\r\n   appender.console.layout.type = PatternLayout\r\n   appender.console.layout.pattern = %d{yy/MM/dd HH:mm:ss,SSS} %p [%t] %c{2}:%L : %m%n\r\n   \r\n   appender.file.type = RollingFile\r\n   appender.file.name = File\r\n   appender.file.fileName = /tmp/spark/logs/spark.log\r\n   appender.file.filePattern = /tmp/spark/logs/spark.%d{yyyyMMdd-HH}.log\r\n   appender.file.append = true\r\n   appender.file.layout.type = PatternLayout\r\n   appender.file.layout.pattern = %d{yy/MM/dd HH:mm:ss,SSS} %p [%t] %c{2}:%L : %m%n\r\n   appender.file.policies.type = Policies\r\n   appender.file.policies.time.type = TimeBasedTriggeringPolicy\r\n   appender.file.policies.time.interval = 1\r\n   appender.file.policies.time.modulate = true\r\n   appender.file.policies.size.type = SizeBasedTriggeringPolicy\r\n   appender.file.policies.size.size = 256M\r\n   appender.file.strategy.type = DefaultRolloverStrategy\r\n   appender.file.strategy.max = 100\r\n   ```\r\n4. Start Spark thriftserver: `sbin/start-thriftserver.sh`.\r\n\r\n5. The log file is empty: `cat /tmp/spark/logs/spark.log`.\r\n\r\n6. Copy the following jars to spark-3.5.0-SNAPSHOT-bin-provided/jars:\r\n   ```\r\n   log4j-1.2-api-2.20.0.jar\r\n   log4j-slf4j2-impl-2.20.0.jar\r\n   ```\r\n7. Restart Spark thriftserver: `sbin/start-thriftserver.sh`.\r\n\r\n8. The log file is not empty: `cat /tmp/spark/logs/spark.log`.\r\n\r\nThis is because hadoop classpath does not contain these jars. So these jars are needed even if `hadoop-provided` is activated\r\n![image](https://github.com/apache/spark/assets/5399861/d53ff28c-05d7-40d7-891f-069449315217)\r\n\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\n\r\nNo.\r\n\r\n### How was this patch tested?\r\n\r\nManual test.",
  "closed_by": {
    "login": "srowen",
    "id": 822522,
    "node_id": "MDQ6VXNlcjgyMjUyMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/822522?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/srowen",
    "html_url": "https://github.com/srowen",
    "followers_url": "https://api.github.com/users/srowen/followers",
    "following_url": "https://api.github.com/users/srowen/following{/other_user}",
    "gists_url": "https://api.github.com/users/srowen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/srowen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/srowen/subscriptions",
    "organizations_url": "https://api.github.com/users/srowen/orgs",
    "repos_url": "https://api.github.com/users/srowen/repos",
    "events_url": "https://api.github.com/users/srowen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/srowen/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/41195/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/41195/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
