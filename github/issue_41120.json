{
  "url": "https://api.github.com/repos/apache/spark/issues/41120",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/41120/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/41120/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/41120/events",
  "html_url": "https://github.com/apache/spark/pull/41120",
  "id": 1703734569,
  "node_id": "PR_kwDOAQXtWs5QLuY-",
  "number": 41120,
  "title": "[SPARK-21195][CORE] Dynamically register metrics from sources as they are reported",
  "user": {
    "login": "robert3005",
    "id": 512084,
    "node_id": "MDQ6VXNlcjUxMjA4NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/512084?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/robert3005",
    "html_url": "https://github.com/robert3005",
    "followers_url": "https://api.github.com/users/robert3005/followers",
    "following_url": "https://api.github.com/users/robert3005/following{/other_user}",
    "gists_url": "https://api.github.com/users/robert3005/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/robert3005/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/robert3005/subscriptions",
    "organizations_url": "https://api.github.com/users/robert3005/orgs",
    "repos_url": "https://api.github.com/users/robert3005/repos",
    "events_url": "https://api.github.com/users/robert3005/events{/privacy}",
    "received_events_url": "https://api.github.com/users/robert3005/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1981527456,
      "node_id": "MDU6TGFiZWwxOTgxNTI3NDU2",
      "url": "https://api.github.com/repos/apache/spark/labels/CORE",
      "name": "CORE",
      "color": "ededed",
      "default": false,
      "description": null
    },
    {
      "id": 1984378631,
      "node_id": "MDU6TGFiZWwxOTg0Mzc4NjMx",
      "url": "https://api.github.com/repos/apache/spark/labels/DSTREAM",
      "name": "DSTREAM",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-05-10T11:43:07Z",
  "updated_at": "2023-05-10T11:43:20Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/41120",
    "html_url": "https://github.com/apache/spark/pull/41120",
    "diff_url": "https://github.com/apache/spark/pull/41120.diff",
    "patch_url": "https://github.com/apache/spark/pull/41120.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\nMetricSystem picks up new metrics from sources that are added throughout execution. If you do measurements via dynamic proxies you might not want to redeclare all metrics that the proxies will create and you'd prefer them to get populated as they're being produced. Right now all sources are processed only onceat startup and metrics are picked up only if they have been registered statically at compile time. Behaviour I am proposing lets you not have to declare metrics in two places.\r\n\r\nThis had been previously suggested in #18406, #29980,  #31267, #35357, #36889, #38209 and #39755.\r\n\r\n### Why are the changes needed?\r\nCurrently there's no way to access MetricRegistry that MetricsSystem uses to hold its state and as such it's not possible to reprocess a source. MetricsSystem throws if any metric had already been registered previously.\r\n\r\nn.b. the MetricRegistry is added as a constructor argument to make testing easier but could as well be accessed via reflection as a private variable.\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nNo\r\n\r\n\r\n### How was this patch tested?\r\nAdded tests\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/41120/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/41120/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
