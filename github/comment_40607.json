[
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1493485269",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1493485269",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1493485269,
    "node_id": "IC_kwDOAQXtWs5ZBMbV",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T00:25:32Z",
    "updated_at": "2023-04-03T00:25:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "cc @WeichenXu123 @HyukjinKwon  I think it is ready to review",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1493485269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1495655168",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1495655168",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1495655168,
    "node_id": "IC_kwDOAQXtWs5ZJeMA",
    "user": {
      "login": "WeichenXu123",
      "id": 19235986,
      "node_id": "MDQ6VXNlcjE5MjM1OTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/19235986?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WeichenXu123",
      "html_url": "https://github.com/WeichenXu123",
      "followers_url": "https://api.github.com/users/WeichenXu123/followers",
      "following_url": "https://api.github.com/users/WeichenXu123/following{/other_user}",
      "gists_url": "https://api.github.com/users/WeichenXu123/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WeichenXu123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WeichenXu123/subscriptions",
      "organizations_url": "https://api.github.com/users/WeichenXu123/orgs",
      "repos_url": "https://api.github.com/users/WeichenXu123/repos",
      "events_url": "https://api.github.com/users/WeichenXu123/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WeichenXu123/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T09:36:33Z",
    "updated_at": "2023-04-04T10:02:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Followup tasks:\r\n\r\n* We should replace `mapInPandas` with `mapInArrow` for better performance\r\n* For each spark task, we should save each partition data into local disk (in arrow format) before starting torch process, and provide utility reading function (returning `torch.utils.data.Dataset` instance) that torch program (running as a child process) can invoke it to iterate the partition data inside torch program.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1495655168/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1495768111",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1495768111",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1495768111,
    "node_id": "IC_kwDOAQXtWs5ZJ5wv",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T11:00:08Z",
    "updated_at": "2023-04-04T11:00:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\r\npyspark.errors.exceptions.connect.SparkConnectGrpcException: <_MultiThreadedRendezvous of RPC that terminated with:\r\n\tstatus = StatusCode.UNKNOWN\r\n\tdetails = \"Java heap space\"\r\n\tdebug_error_string = \"UNKNOWN:Error received from peer ipv4:127.0.0.1:39429 {grpc_message:\"Java heap space\", grpc_status:2, created_time:\"2023-04-04T10:54:38.384319228+00:00\"}\"\r\n>\r\n```\r\nit fails again even I switch back to the initial approach, the error is raised in the server side, so should not be related to the way to concat. I guess there is no enough RAM.\r\n\r\ncc @HyukjinKwon are those UTs tested in parallel or one by one?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1495768111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1495858338",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1495858338",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1495858338,
    "node_id": "IC_kwDOAQXtWs5ZKPyi",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T12:06:24Z",
    "updated_at": "2023-04-04T12:24:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "the GA status is missing, https://github.com/zhengruifeng/spark/actions/runs/4607449033",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1495858338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1496734980",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1496734980",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1496734980,
    "node_id": "IC_kwDOAQXtWs5ZNl0E",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T23:49:26Z",
    "updated_at": "2023-04-04T23:49:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "In my local env, the failed test can pass with even bigger model size.\r\nbut let me try to reduce the model size for GA to see what will happen.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1496734980/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1497315263",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1497315263",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1497315263,
    "node_id": "IC_kwDOAQXtWs5ZPze_",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T11:13:35Z",
    "updated_at": "2023-04-05T11:13:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am hitting a weird failure of `TorchDistributorDistributedUnitTestsOnConnect.test_parity_torch_distributor`, it appeared after I rebase this PR yesterday, but I don't find any suspicious commits merged recently.\r\n\r\n```\r\n======================================================================\r\nERROR [18.362s]: test_end_to_end_run_distributedly (pyspark.ml.tests.connect.test_parity_torch_distributor.TorchDistributorDistributedUnitTestsOnConnect)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/__w/spark/spark/python/pyspark/ml/torch/tests/test_distributor.py\", line 457, in test_end_to_end_run_distributedly\r\n    output = TorchDistributor(num_processes=2, local_mode=False, use_gpu=False).run(\r\n  File \"/__w/spark/spark/python/pyspark/ml/torch/distributor.py\", line 749, in run\r\n    output = self._run_distributed_training(framework_wrapper_fn, train_object, *args)\r\n  File \"/__w/spark/spark/python/pyspark/ml/torch/distributor.py\", line 607, in _run_distributed_training\r\n    self.spark.range(start=0, end=self.num_tasks, step=1, numPartitions=self.num_tasks)\r\n  File \"/__w/spark/spark/python/pyspark/sql/connect/dataframe.py\", line 1354, in collect\r\n    table, schema = self._session.client.to_table(query)\r\n  File \"/__w/spark/spark/python/pyspark/sql/connect/client.py\", line 668, in to_table\r\n    table, schema, _, _, _ = self._execute_and_fetch(req)\r\n  File \"/__w/spark/spark/python/pyspark/sql/connect/client.py\", line 982, in _execute_and_fetch\r\n    for response in self._execute_and_fetch_as_iterator(req):\r\n  File \"/__w/spark/spark/python/pyspark/sql/connect/client.py\", line 963, in _execute_and_fetch_as_iterator\r\n    self._handle_error(error)\r\n  File \"/__w/spark/spark/python/pyspark/sql/connect/client.py\", line 1055, in _handle_error\r\n    self._handle_rpc_error(error)\r\n  File \"/__w/spark/spark/python/pyspark/sql/connect/client.py\", line 1095, in _handle_rpc_error\r\n    raise SparkConnectGrpcException(str(rpc_error)) from None\r\npyspark.errors.exceptions.connect.SparkConnectGrpcException: <_MultiThreadedRendezvous of RPC that terminated with:\r\n\tstatus = StatusCode.UNKNOWN\r\n\tdetails = \"Java heap space\"\r\n\tdebug_error_string = \"UNKNOWN:Error received from peer ipv4:127.0.0.1:35071 {created_time:\"2023-04-05T10:13:52.254507275+00:00\", grpc_status:2, grpc_message:\"Java heap space\"}\"\r\n>\r\n```\r\n\r\n\r\nIn my local env, I can only repro this by decreasing the driver memory (e.g. \"spark.driver.memory\", \"512M\"), And this issue can be simply resolve by increase the driver memory to 1024M.\r\nI tests different combinations locally like:\r\n`spark.driver.memory=1024M, spark.executor.memory=512M`\r\n`spark.driver.memory=1024M, spark.executor.memory=1024M`\r\netc\r\nand they also works as expected.\r\n\r\nBut in Github Action (this resource limitation seems to be https://github.com/apache/spark/blob/0b45a5278026c2ea9ce2b127333514f7a7a933f4/.github/workflows/build_and_test.yml#L1028), no matter how larger driver memory I set (3G, 4G), this test just keeps failing with this error message.\r\n\r\nDo you have any thoughts on this? @WeichenXu123 @HyukjinKwon \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1497315263/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1498386497",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1498386497",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1498386497,
    "node_id": "IC_kwDOAQXtWs5ZT5BB",
    "user": {
      "login": "WeichenXu123",
      "id": 19235986,
      "node_id": "MDQ6VXNlcjE5MjM1OTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/19235986?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WeichenXu123",
      "html_url": "https://github.com/WeichenXu123",
      "followers_url": "https://api.github.com/users/WeichenXu123/followers",
      "following_url": "https://api.github.com/users/WeichenXu123/following{/other_user}",
      "gists_url": "https://api.github.com/users/WeichenXu123/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WeichenXu123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WeichenXu123/subscriptions",
      "organizations_url": "https://api.github.com/users/WeichenXu123/orgs",
      "repos_url": "https://api.github.com/users/WeichenXu123/repos",
      "events_url": "https://api.github.com/users/WeichenXu123/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WeichenXu123/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-06T01:56:46Z",
    "updated_at": "2023-04-06T01:56:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@HyukjinKwon WDYT ? Can we increase CI bot memory capacity ?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1498386497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1499783849",
    "html_url": "https://github.com/apache/spark/pull/40607#issuecomment-1499783849",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40607",
    "id": 1499783849,
    "node_id": "IC_kwDOAQXtWs5ZZOKp",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-07T00:16:37Z",
    "updated_at": "2023-04-07T00:16:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks all for the reviews, merged into master",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1499783849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
