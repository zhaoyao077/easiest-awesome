{
  "url": "https://api.github.com/repos/apache/spark/issues/40031",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/40031/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/40031/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/40031/events",
  "html_url": "https://github.com/apache/spark/pull/40031",
  "id": 1585265180,
  "node_id": "PR_kwDOAQXtWs5KAMBd",
  "number": 40031,
  "title": "[SPARK-42445][R] Fix SparkR `install.spark` function",
  "user": {
    "login": "dongjoon-hyun",
    "id": 9700541,
    "node_id": "MDQ6VXNlcjk3MDA1NDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dongjoon-hyun",
    "html_url": "https://github.com/dongjoon-hyun",
    "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
    "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
    "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
    "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
    "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
    "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1984361638,
      "node_id": "MDU6TGFiZWwxOTg0MzYxNjM4",
      "url": "https://api.github.com/repos/apache/spark/labels/R",
      "name": "R",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-02-15T05:51:59Z",
  "updated_at": "2023-02-15T17:32:18Z",
  "closed_at": "2023-02-15T17:31:26Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/40031",
    "html_url": "https://github.com/apache/spark/pull/40031",
    "diff_url": "https://github.com/apache/spark/pull/40031.diff",
    "patch_url": "https://github.com/apache/spark/pull/40031.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\n\r\nThis PR fixes `SparkR` `install.spark` method.\r\n\r\n```\r\n$ curl -LO https://dist.apache.org/repos/dist/dev/spark/v3.3.2-rc1-bin/SparkR_3.3.2.tar.gz\r\n$ R CMD INSTALL SparkR_3.3.2.tar.gz\r\n$ R\r\n\r\nR version 4.2.1 (2022-06-23) -- \"Funny-Looking Kid\"\r\nCopyright (C) 2022 The R Foundation for Statistical Computing\r\nPlatform: aarch64-apple-darwin20 (64-bit)\r\n\r\nR is free software and comes with ABSOLUTELY NO WARRANTY.\r\nYou are welcome to redistribute it under certain conditions.\r\nType 'license()' or 'licence()' for distribution details.\r\n\r\n  Natural language support but running in an English locale\r\n\r\nR is a collaborative project with many contributors.\r\nType 'contributors()' for more information and\r\n'citation()' on how to cite R or R packages in publications.\r\n\r\nType 'demo()' for some demos, 'help()' for on-line help, or\r\n'help.start()' for an HTML browser interface to help.\r\nType 'q()' to quit R.\r\n\r\n> library(SparkR)\r\n\r\nAttaching package: ‘SparkR’\r\n\r\nThe following objects are masked from ‘package:stats’:\r\n\r\n    cov, filter, lag, na.omit, predict, sd, var, window\r\n\r\nThe following objects are masked from ‘package:base’:\r\n\r\n    as.data.frame, colnames, colnames<-, drop, endsWith, intersect,\r\n    rank, rbind, sample, startsWith, subset, summary, transform, union\r\n\r\n> install.spark()\r\nSpark not found in the cache directory. Installation will start.\r\nMirrorUrl not provided.\r\nLooking for preferred site from apache website...\r\nPreferred mirror site found: https://dlcdn.apache.org/spark\r\nDownloading spark-3.3.2 for Hadoop 2.7 from:\r\n- https://dlcdn.apache.org/spark/spark-3.3.2/spark-3.3.2-bin-hadoop2.7.tgz\r\ntrying URL 'https://dlcdn.apache.org/spark/spark-3.3.2/spark-3.3.2-bin-hadoop2.7.tgz'\r\nsimpleWarning in download.file(remotePath, localPath): downloaded length 0 != reported length 196\r\n\r\n> install.spark(hadoopVersion=\"3\")\r\nSpark not found in the cache directory. Installation will start.\r\nMirrorUrl not provided.\r\nLooking for preferred site from apache website...\r\nPreferred mirror site found: https://dlcdn.apache.org/spark\r\nDownloading spark-3.3.2 for Hadoop 3 from:\r\n- https://dlcdn.apache.org/spark/spark-3.3.2/spark-3.3.2-bin-3.tgz\r\ntrying URL 'https://dlcdn.apache.org/spark/spark-3.3.2/spark-3.3.2-bin-3.tgz'\r\nsimpleWarning in download.file(remotePath, localPath): downloaded length 0 != reported length 196\r\n```\r\n\r\nNote that this is a regression at Spark 3.3.0 and not a blocker for on-going Spark 3.3.2 RC vote.\r\n\r\n### Why are the changes needed?\r\n\r\nhttps://spark.apache.org/docs/latest/api/R/reference/install.spark.html#ref-usage\r\n![Screenshot 2023-02-14 at 10 07 49 PM](https://user-images.githubusercontent.com/9700541/218946460-ab7eab1b-65ae-4cb2-bc7c-5810ad359ac9.png)\r\n\r\n\r\nFirst, the existing Spark 2.0.0 link is broken.\r\n- https://spark.apache.org/docs/latest/api/R/reference/install.spark.html#details\r\n- http://apache.osuosl.org/spark/spark-2.0.0/spark-2.0.0-bin-hadoop2.7.tgz (Broken)\r\n\r\nSecond, Spark 3.3.0 changed the Hadoop postfix pattern from the distribution files so that the function raises errors as described before.\r\n- http://archive.apache.org/dist/spark/spark-3.2.3/spark-3.2.3-bin-hadoop2.7.tgz (Old Pattern)\r\n- http://archive.apache.org/dist/spark/spark-3.3.0/spark-3.3.0-bin-hadoop2.tgz (New Pattern)\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\n\r\nNo, this fixes a bug like Spark 3.2.3 and older versions.\r\n\r\n### How was this patch tested?\r\n\r\nPass the CI and manual testing. Please note that the link pattern is correct although it fails because 3.5.0 is not published yet.\r\n```\r\n$ NO_MANUAL=1 ./dev/make-distribution.sh --r\r\n$ R CMD INSTALL R/SparkR_3.5.0-SNAPSHOT.tar.gz\r\n$ R\r\n> library(SparkR)\r\n> install.spark()\r\nSpark not found in the cache directory. Installation will start.\r\nMirrorUrl not provided.\r\nLooking for preferred site from apache website...\r\nPreferred mirror site found: https://dlcdn.apache.org/spark\r\nDownloading spark-3.5.0 for Hadoop 3 from:\r\n- https://dlcdn.apache.org/spark/spark-3.5.0/spark-3.5.0-bin-hadoop3.tgz\r\ntrying URL 'https://dlcdn.apache.org/spark/spark-3.5.0/spark-3.5.0-bin-hadoop3.tgz'\r\nsimpleWarning in download.file(remotePath, localPath): downloaded length 0 != reported length 196\r\n```",
  "closed_by": {
    "login": "dongjoon-hyun",
    "id": 9700541,
    "node_id": "MDQ6VXNlcjk3MDA1NDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9700541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dongjoon-hyun",
    "html_url": "https://github.com/dongjoon-hyun",
    "followers_url": "https://api.github.com/users/dongjoon-hyun/followers",
    "following_url": "https://api.github.com/users/dongjoon-hyun/following{/other_user}",
    "gists_url": "https://api.github.com/users/dongjoon-hyun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dongjoon-hyun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dongjoon-hyun/subscriptions",
    "organizations_url": "https://api.github.com/users/dongjoon-hyun/orgs",
    "repos_url": "https://api.github.com/users/dongjoon-hyun/repos",
    "events_url": "https://api.github.com/users/dongjoon-hyun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dongjoon-hyun/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/40031/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/40031/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
