[
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1467212310",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1467212310",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1467212310,
    "node_id": "IC_kwDOAQXtWs5Xc-IW",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-14T01:37:05Z",
    "updated_at": "2023-03-14T01:37:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "also cc @WeichenXu123 since this PR supports `df.collect` with UDT",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1467212310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1474479783",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1474479783",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1474479783,
    "node_id": "IC_kwDOAQXtWs5X4san",
    "user": {
      "login": "ueshin",
      "id": 506656,
      "node_id": "MDQ6VXNlcjUwNjY1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/506656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ueshin",
      "html_url": "https://github.com/ueshin",
      "followers_url": "https://api.github.com/users/ueshin/followers",
      "following_url": "https://api.github.com/users/ueshin/following{/other_user}",
      "gists_url": "https://api.github.com/users/ueshin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ueshin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ueshin/subscriptions",
      "organizations_url": "https://api.github.com/users/ueshin/orgs",
      "repos_url": "https://api.github.com/users/ueshin/repos",
      "events_url": "https://api.github.com/users/ueshin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ueshin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-17T22:43:37Z",
    "updated_at": "2023-03-17T22:43:37Z",
    "author_association": "MEMBER",
    "body": "@zhengruifeng Sorry, I missed your comment:\r\n\r\n> will there be another PR for the support of UDT in `createDataFrame`?\r\n\r\nNo, this also enables UDT in `createDataFrame`.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1474479783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1475453518",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1475453518",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1475453518,
    "node_id": "IC_kwDOAQXtWs5X8aJO",
    "user": {
      "login": "HyukjinKwon",
      "id": 6477701,
      "node_id": "MDQ6VXNlcjY0Nzc3MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6477701?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/HyukjinKwon",
      "html_url": "https://github.com/HyukjinKwon",
      "followers_url": "https://api.github.com/users/HyukjinKwon/followers",
      "following_url": "https://api.github.com/users/HyukjinKwon/following{/other_user}",
      "gists_url": "https://api.github.com/users/HyukjinKwon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/HyukjinKwon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/HyukjinKwon/subscriptions",
      "organizations_url": "https://api.github.com/users/HyukjinKwon/orgs",
      "repos_url": "https://api.github.com/users/HyukjinKwon/repos",
      "events_url": "https://api.github.com/users/HyukjinKwon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/HyukjinKwon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T00:24:12Z",
    "updated_at": "2023-03-20T00:24:12Z",
    "author_association": "MEMBER",
    "body": "Merged to master and branch-3.4.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1475453518/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1477202593",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1477202593",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1477202593,
    "node_id": "IC_kwDOAQXtWs5YDFKh",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T02:40:10Z",
    "updated_at": "2023-03-21T02:40:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ueshin it seem that `createDataFrame` always use the underlying `sqlType` other than the UDT itself:\r\n\r\n```\r\nIn [1]: from pyspark.ml.linalg import Vectors\r\n\r\nIn [2]: df = spark.createDataFrame([(1.0, 1.0, Vectors.dense(0.0, 5.0)), (0.0, 2.0, Vectors.dense(1.0, 2.0)), (1.0, 3.0, Vectors.dense(2.0,\r\n   ...: 1.0)), (0.0, 4.0, Vectors.dense(3.0, 3.0)),], [\"label\", \"weight\", \"features\"],)\r\n\r\nIn [3]: df.schema\r\nOut[3]: StructType([StructField('label', DoubleType(), True), StructField('weight', DoubleType(), True), StructField('features', StructType([StructField('type', ByteType(), False), StructField('size', IntegerType(), True), StructField('indices', ArrayType(IntegerType(), False), True), StructField('values', ArrayType(DoubleType(), False), True)]), True)])\r\n\r\nIn [4]: df.collect()\r\nOut[4]: :>                                                          (0 + 4) / 4]\r\n[Row(label=1.0, weight=1.0, features=Row(type=1, size=None, indices=None, values=[0.0, 5.0])),\r\n Row(label=0.0, weight=2.0, features=Row(type=1, size=None, indices=None, values=[1.0, 2.0])),\r\n Row(label=1.0, weight=3.0, features=Row(type=1, size=None, indices=None, values=[2.0, 1.0])),\r\n Row(label=0.0, weight=4.0, features=Row(type=1, size=None, indices=None, values=[3.0, 3.0]))]\r\n```\r\n\r\nwhile in vanilla PySpark:\r\n```\r\nIn [1]: from pyspark.ml.linalg import Vectors\r\n\r\nIn [2]: df = spark.createDataFrame([(1.0, 1.0, Vectors.dense(0.0, 5.0)), (0.0, 2.0, Vectors.dense(1.0, 2.0)), (1.0, 3.0, Vectors.dense(2.0,\r\n   ...:    ...: 1.0)), (0.0, 4.0, Vectors.dense(3.0, 3.0)),], [\"label\", \"weight\", \"features\"],)\r\n\r\nIn [3]: df.schema\r\nOut[3]: StructType([StructField('label', DoubleType(), True), StructField('weight', DoubleType(), True), StructField('features', VectorUDT(), True)])\r\n\r\nIn [4]: df.collect()\r\nOut[4]:                                                                         \r\n[Row(label=1.0, weight=1.0, features=DenseVector([0.0, 5.0])),\r\n Row(label=0.0, weight=2.0, features=DenseVector([1.0, 2.0])),\r\n Row(label=1.0, weight=3.0, features=DenseVector([2.0, 1.0])),\r\n Row(label=0.0, weight=4.0, features=DenseVector([3.0, 3.0]))]\r\n```\r\n\r\n\r\nalso cc @WeichenXu123 ",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1477202593/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1477209035",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1477209035",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1477209035,
    "node_id": "IC_kwDOAQXtWs5YDGvL",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T02:51:27Z",
    "updated_at": "2023-03-21T02:51:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "I save a df with UDT in pyspark, and then read it in python client, and it works fine. So I guess something is wrong in \r\n`createDataFrame`\r\n\r\nvanilla PySpark:\r\n```\r\nIn [1]: from pyspark.ml.linalg import Vectors\r\n\r\nIn [2]: df = spark.createDataFrame([(1.0, 1.0, Vectors.dense(0.0, 5.0)), (0.0, 2.0, Vectors.dense(1.0, 2.0)), (1.0, 3.0, Vectors.dense(2.0,\r\n   ...:    ...: 1.0)), (0.0, 4.0, Vectors.dense(3.0, 3.0)),], [\"label\", \"weight\", \"features\"],)\r\n\r\nIn [3]: df.write.parquet(\"/tmp/tmp.pq\")\r\n```\r\n\r\nPython Client:\r\n```\r\nIn [6]: df = spark.read.parquet(\"/tmp/tmp.pq\")\r\n\r\nIn [7]: df.schema\r\nOut[7]: StructType([StructField('label', DoubleType(), True), StructField('weight', DoubleType(), True), StructField('features', VectorUDT(), True)])\r\n\r\nIn [8]: df.collect()\r\nOut[8]: \r\n[Row(label=0.0, weight=4.0, features=DenseVector([3.0, 3.0])),\r\n Row(label=0.0, weight=2.0, features=DenseVector([1.0, 2.0])),\r\n Row(label=1.0, weight=3.0, features=DenseVector([2.0, 1.0])),\r\n Row(label=1.0, weight=1.0, features=DenseVector([0.0, 5.0]))]\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1477209035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1477260665",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1477260665",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1477260665,
    "node_id": "IC_kwDOAQXtWs5YDTV5",
    "user": {
      "login": "ueshin",
      "id": 506656,
      "node_id": "MDQ6VXNlcjUwNjY1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/506656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ueshin",
      "html_url": "https://github.com/ueshin",
      "followers_url": "https://api.github.com/users/ueshin/followers",
      "following_url": "https://api.github.com/users/ueshin/following{/other_user}",
      "gists_url": "https://api.github.com/users/ueshin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ueshin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ueshin/subscriptions",
      "organizations_url": "https://api.github.com/users/ueshin/orgs",
      "repos_url": "https://api.github.com/users/ueshin/repos",
      "events_url": "https://api.github.com/users/ueshin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ueshin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T04:18:29Z",
    "updated_at": "2023-03-21T04:18:29Z",
    "author_association": "MEMBER",
    "body": "@zhengruifeng ah, seems like something is wrong when the schema is a column name list.\r\nCould you use `StructType` to specify the schema as a workaround?\r\nI'll take a look later.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1477260665/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1477518340",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1477518340",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1477518340,
    "node_id": "IC_kwDOAQXtWs5YESQE",
    "user": {
      "login": "zhengruifeng",
      "id": 7322292,
      "node_id": "MDQ6VXNlcjczMjIyOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7322292?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhengruifeng",
      "html_url": "https://github.com/zhengruifeng",
      "followers_url": "https://api.github.com/users/zhengruifeng/followers",
      "following_url": "https://api.github.com/users/zhengruifeng/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhengruifeng/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhengruifeng/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhengruifeng/subscriptions",
      "organizations_url": "https://api.github.com/users/zhengruifeng/orgs",
      "repos_url": "https://api.github.com/users/zhengruifeng/repos",
      "events_url": "https://api.github.com/users/zhengruifeng/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhengruifeng/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T09:31:54Z",
    "updated_at": "2023-03-21T09:31:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ueshin Sure, thanks!\r\n\r\n`StructType().add(\"label\", DoubleType()).add(\"weight\", DoubleType()).add(\"features\", VectorUDT(), False)` works, but the `nullable` in column `features` must be `False`, otherwise:\r\n```\r\nAnalysisException: [NULLABLE_COLUMN_OR_FIELD] Column or field `features`.`type` is nullable while it's required to be non-nullable.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1477518340/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1480349942",
    "html_url": "https://github.com/apache/spark/pull/40402#issuecomment-1480349942",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40402",
    "id": 1480349942,
    "node_id": "IC_kwDOAQXtWs5YPFj2",
    "user": {
      "login": "ueshin",
      "id": 506656,
      "node_id": "MDQ6VXNlcjUwNjY1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/506656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ueshin",
      "html_url": "https://github.com/ueshin",
      "followers_url": "https://api.github.com/users/ueshin/followers",
      "following_url": "https://api.github.com/users/ueshin/following{/other_user}",
      "gists_url": "https://api.github.com/users/ueshin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ueshin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ueshin/subscriptions",
      "organizations_url": "https://api.github.com/users/ueshin/orgs",
      "repos_url": "https://api.github.com/users/ueshin/repos",
      "events_url": "https://api.github.com/users/ueshin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ueshin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-22T22:42:09Z",
    "updated_at": "2023-03-22T22:42:09Z",
    "author_association": "MEMBER",
    "body": "@zhengruifeng I submitted two PRs: #40526 and #40527.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1480349942/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
