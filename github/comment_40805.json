[
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1510589717",
    "html_url": "https://github.com/apache/spark/pull/40805#issuecomment-1510589717",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40805",
    "id": 1510589717,
    "node_id": "IC_kwDOAQXtWs5aCcUV",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-17T02:07:38Z",
    "updated_at": "2023-04-17T02:07:38Z",
    "author_association": "MEMBER",
    "body": "@cloud-fan @sunchao ",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1510589717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1510667065",
    "html_url": "https://github.com/apache/spark/pull/40805#issuecomment-1510667065",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40805",
    "id": 1510667065,
    "node_id": "IC_kwDOAQXtWs5aCvM5",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-17T04:07:32Z",
    "updated_at": "2023-04-17T04:07:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "@wangyum can we mention the idea a bit more? Do we push down the cast in join condition to the join children?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1510667065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1510807373",
    "html_url": "https://github.com/apache/spark/pull/40805#issuecomment-1510807373",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40805",
    "id": 1510807373,
    "node_id": "IC_kwDOAQXtWs5aDRdN",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-17T07:00:15Z",
    "updated_at": "2023-04-17T07:00:15Z",
    "author_association": "MEMBER",
    "body": "@cloud-fan OK, updated the description of the PR. We do not push down the cast to the  join children. This rule is the same as `CoalesceBucketsInJoin`. Must also must before `EnsureRequirements`. The join's children must be the filter, project and stream side of broadcast join.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1510807373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1510825983",
    "html_url": "https://github.com/apache/spark/pull/40805#issuecomment-1510825983",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40805",
    "id": 1510825983,
    "node_id": "IC_kwDOAQXtWs5aDV__",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-17T07:14:51Z",
    "updated_at": "2023-04-17T07:14:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can we fix this issue by pulling out expressions of join conditions to Projects under Join? IIRC you had a PR for it and then the join condition should only contains attributes.",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1510825983/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1511025438",
    "html_url": "https://github.com/apache/spark/pull/40805#issuecomment-1511025438",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40805",
    "id": 1511025438,
    "node_id": "IC_kwDOAQXtWs5aEGse",
    "user": {
      "login": "wangyum",
      "id": 5399861,
      "node_id": "MDQ6VXNlcjUzOTk4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5399861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyum",
      "html_url": "https://github.com/wangyum",
      "followers_url": "https://api.github.com/users/wangyum/followers",
      "following_url": "https://api.github.com/users/wangyum/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyum/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyum/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyum/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyum/orgs",
      "repos_url": "https://api.github.com/users/wangyum/repos",
      "events_url": "https://api.github.com/users/wangyum/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyum/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-17T09:42:23Z",
    "updated_at": "2023-04-17T10:20:11Z",
    "author_association": "MEMBER",
    "body": "Pulling out join condition can't fix this issue because the [output partitioning](https://github.com/apache/spark/blob/72922adc8a78e8d31f03205a148b89291a9a4d19/sql/core/src/main/scala/org/apache/spark/sql/execution/AliasAwareOutputExpression.scala#L57) is `UnknownPartitioning(Bucket Number)` which can't satisfy the `SortMergeJoin`, and also needs to introduce shuffle.\r\n\r\n```sql\r\nSELECT *\r\nFROM   (SELECT Cast(i AS DECIMAL(20, 0)) AS i FROM t2) tmp1\r\nJOIN   (SELECT Cast(i AS DECIMAL(20, 0)) AS i FROM t3) tmp2\r\nON     tmp1.i = tmp2.i; \r\n```\r\n\r\n```\r\n== Physical Plan ==\r\nAdaptiveSparkPlan isFinalPlan=false\r\n+- SortMergeJoin [i#23], [i#24], Inner\r\n   :- Sort [i#23 ASC NULLS FIRST], false, 0\r\n   :  +- Exchange hashpartitioning(i#23, 200), ENSURE_REQUIREMENTS, [plan_id=130]\r\n   :     +- Project [cast(i#19L as decimal(20,0)) AS i#23]\r\n   :        +- Filter isnotnull(cast(i#19L as decimal(20,0)))\r\n   :           +- FileScan parquet spark_catalog.default.t2[i#19L] Batched: true, Bucketed: false (disabled by query planner)\r\n   +- Sort [i#24 ASC NULLS FIRST], false, 0\r\n      +- Exchange hashpartitioning(i#24, 200), ENSURE_REQUIREMENTS, [plan_id=135]\r\n         +- Project [cast(i#20 as decimal(20,0)) AS i#24]\r\n            +- Filter isnotnull(cast(i#20 as decimal(20,0)))\r\n               +- FileScan parquet spark_catalog.default.t3[i#20] Batched: true, Bucketed: false (disabled by query planner)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1511025438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/apache/spark/issues/comments/1512508095",
    "html_url": "https://github.com/apache/spark/pull/40805#issuecomment-1512508095",
    "issue_url": "https://api.github.com/repos/apache/spark/issues/40805",
    "id": 1512508095,
    "node_id": "IC_kwDOAQXtWs5aJwq_",
    "user": {
      "login": "cloud-fan",
      "id": 3182036,
      "node_id": "MDQ6VXNlcjMxODIwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3182036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloud-fan",
      "html_url": "https://github.com/cloud-fan",
      "followers_url": "https://api.github.com/users/cloud-fan/followers",
      "following_url": "https://api.github.com/users/cloud-fan/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloud-fan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloud-fan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloud-fan/subscriptions",
      "organizations_url": "https://api.github.com/users/cloud-fan/orgs",
      "repos_url": "https://api.github.com/users/cloud-fan/repos",
      "events_url": "https://api.github.com/users/cloud-fan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloud-fan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-18T06:26:11Z",
    "updated_at": "2023-04-18T06:26:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Shall we improve the partitioning propagation to support cast?",
    "reactions": {
      "url": "https://api.github.com/repos/apache/spark/issues/comments/1512508095/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
