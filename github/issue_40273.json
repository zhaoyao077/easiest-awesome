{
  "url": "https://api.github.com/repos/apache/spark/issues/40273",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/40273/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/40273/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/40273/events",
  "html_url": "https://github.com/apache/spark/pull/40273",
  "id": 1609486187,
  "node_id": "PR_kwDOAQXtWs5LRVca",
  "number": 40273,
  "title": "[SPARK-42668][SS] Catch exception while trying to close compressed stream in HDFSStateStoreProvider abort",
  "user": {
    "login": "anishshri-db",
    "id": 100322362,
    "node_id": "U_kgDOBfrMOg",
    "avatar_url": "https://avatars.githubusercontent.com/u/100322362?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/anishshri-db",
    "html_url": "https://github.com/anishshri-db",
    "followers_url": "https://api.github.com/users/anishshri-db/followers",
    "following_url": "https://api.github.com/users/anishshri-db/following{/other_user}",
    "gists_url": "https://api.github.com/users/anishshri-db/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/anishshri-db/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/anishshri-db/subscriptions",
    "organizations_url": "https://api.github.com/users/anishshri-db/orgs",
    "repos_url": "https://api.github.com/users/anishshri-db/repos",
    "events_url": "https://api.github.com/users/anishshri-db/events{/privacy}",
    "received_events_url": "https://api.github.com/users/anishshri-db/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1405794576,
      "node_id": "MDU6TGFiZWwxNDA1Nzk0NTc2",
      "url": "https://api.github.com/repos/apache/spark/labels/SQL",
      "name": "SQL",
      "color": "ededed",
      "default": false,
      "description": null
    },
    {
      "id": 1406587328,
      "node_id": "MDU6TGFiZWwxNDA2NTg3MzI4",
      "url": "https://api.github.com/repos/apache/spark/labels/STRUCTURED%20STREAMING",
      "name": "STRUCTURED STREAMING",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-03-04T00:36:47Z",
  "updated_at": "2023-03-06T11:23:26Z",
  "closed_at": "2023-03-06T11:23:26Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/40273",
    "html_url": "https://github.com/apache/spark/pull/40273",
    "diff_url": "https://github.com/apache/spark/pull/40273.diff",
    "patch_url": "https://github.com/apache/spark/pull/40273.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\nWe have seen some cases where the task exits as cancelled/failed which triggers the abort in the task completion listener for HDFSStateStoreProvider. As part of this, we cancel the backing stream and close the compressed stream. However, different stores such as Azure blob store could throw exceptions which are not caught in the current path, leading to job failures. This change proposes to fix this issue by catching all non fatal exceptions thrown by cancel/close.\r\n\r\n\r\n### Why are the changes needed?\r\nChanges are required to avoid job failures due to exceptions thrown by output stream handlers on abort with the HDFSStateStoreProvider.\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nNo\r\n\r\n### How was this patch tested?\r\nModified a test and simulated a NPE in the abort path and verified that the task and thereby the job fails before this change.\r\nAfter the change, the test passes fine.\r\n",
  "closed_by": {
    "login": "HeartSaVioR",
    "id": 1317309,
    "node_id": "MDQ6VXNlcjEzMTczMDk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1317309?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/HeartSaVioR",
    "html_url": "https://github.com/HeartSaVioR",
    "followers_url": "https://api.github.com/users/HeartSaVioR/followers",
    "following_url": "https://api.github.com/users/HeartSaVioR/following{/other_user}",
    "gists_url": "https://api.github.com/users/HeartSaVioR/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/HeartSaVioR/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/HeartSaVioR/subscriptions",
    "organizations_url": "https://api.github.com/users/HeartSaVioR/orgs",
    "repos_url": "https://api.github.com/users/HeartSaVioR/repos",
    "events_url": "https://api.github.com/users/HeartSaVioR/events{/privacy}",
    "received_events_url": "https://api.github.com/users/HeartSaVioR/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/40273/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/40273/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
