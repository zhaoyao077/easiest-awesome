{
  "url": "https://api.github.com/repos/apache/spark/issues/40274",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/40274/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/40274/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/40274/events",
  "html_url": "https://github.com/apache/spark/pull/40274",
  "id": 1609507050,
  "node_id": "PR_kwDOAQXtWs5LRaBG",
  "number": 40274,
  "title": "[SPARK-42215][CONNECT] Simplify Scala Client IT tests",
  "user": {
    "login": "zhenlineo",
    "id": 4190164,
    "node_id": "MDQ6VXNlcjQxOTAxNjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4190164?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhenlineo",
    "html_url": "https://github.com/zhenlineo",
    "followers_url": "https://api.github.com/users/zhenlineo/followers",
    "following_url": "https://api.github.com/users/zhenlineo/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhenlineo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhenlineo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhenlineo/subscriptions",
    "organizations_url": "https://api.github.com/users/zhenlineo/orgs",
    "repos_url": "https://api.github.com/users/zhenlineo/repos",
    "events_url": "https://api.github.com/users/zhenlineo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhenlineo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1405794576,
      "node_id": "MDU6TGFiZWwxNDA1Nzk0NTc2",
      "url": "https://api.github.com/repos/apache/spark/labels/SQL",
      "name": "SQL",
      "color": "ededed",
      "default": false,
      "description": null
    },
    {
      "id": 1406627200,
      "node_id": "MDU6TGFiZWwxNDA2NjI3MjAw",
      "url": "https://api.github.com/repos/apache/spark/labels/BUILD",
      "name": "BUILD",
      "color": "ededed",
      "default": false,
      "description": null
    },
    {
      "id": 4556440342,
      "node_id": "LA_kwDOAQXtWs8AAAABD5XDFg",
      "url": "https://api.github.com/repos/apache/spark/labels/CONNECT",
      "name": "CONNECT",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2023-03-04T01:06:04Z",
  "updated_at": "2023-04-07T21:42:03Z",
  "closed_at": "2023-04-07T21:42:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/40274",
    "html_url": "https://github.com/apache/spark/pull/40274",
    "diff_url": "https://github.com/apache/spark/pull/40274.diff",
    "patch_url": "https://github.com/apache/spark/pull/40274.patch",
    "merged_at": null
  },
  "body": "### What changes were proposed in this pull request?\r\nMake use of the new spark-connect script to make the Scala client test to not directly depends on any other modules.\r\nThe dependency is still there but hidden by the spark-connect script. When calling the script to start the server, the script performs a `build/sbt package` to ensure all the jars are build and can be found in the correct path. \r\n\r\nAfter the change, we can use the following commands to run the Scala client tests:\r\n```\r\nbuild/mvn clean\r\nbuild/mvn compile -pl connector/connect/client/jvm\r\nbuild/mvn test -pl connector/connect/client/jvm\r\n```\r\n\r\n```\r\nbuild/sbt clean\r\nbuild/sbt \"testOnly org.apache.spark.sql.ClientE2ETestSuite\" \r\n```\r\n\r\n```\r\nbuild/sbt clean\r\nbuild/sbt \"connect-client-jvm/test\"\r\n```\r\n\r\n**Scala 2.13**\r\n```\r\nbuild/mvn clean\r\nbuild/mvn -Pscala-2.13 compile -pl connector/connect/client/jvm -am -DskipTests\r\nbuild/mvn -Pscala-2.13 test -pl connector/connect/client/jvm\r\n\r\n// These commands failed with errors to find catalyst ArrowWriter. The error seems unrelated to this change.\r\n```\r\n\r\n```\r\nbuild/sbt clean\r\nbuild/sbt \"testOnly org.apache.spark.sql.ClientE2ETestSuite\" -Pscala-2.13\r\n```\r\n\r\n```\r\nbuild/sbt clean\r\nbuild/sbt \"connect-client-jvm/test\" -Pscala-2.13\r\n```\r\n\r\nAfter the change, the waiting time to run the E2ESuite is ~3min for a clean build. Then ~1min for subsequent runs. The test is slower only because we moved the build time from many commands to this single command. There is no limitations to add more tests as the delay is only caused by the shared server start time. Once the server is started, the tests run fast.\r\n\r\n### Why are the changes needed?\r\nA single command for maven users to mvn clean install to run tests and build.\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nNo\r\n\r\n### How was this patch tested?\r\nBuild, Manual tests.",
  "closed_by": {
    "login": "zhenlineo",
    "id": 4190164,
    "node_id": "MDQ6VXNlcjQxOTAxNjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4190164?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhenlineo",
    "html_url": "https://github.com/zhenlineo",
    "followers_url": "https://api.github.com/users/zhenlineo/followers",
    "following_url": "https://api.github.com/users/zhenlineo/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhenlineo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhenlineo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhenlineo/subscriptions",
    "organizations_url": "https://api.github.com/users/zhenlineo/orgs",
    "repos_url": "https://api.github.com/users/zhenlineo/repos",
    "events_url": "https://api.github.com/users/zhenlineo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhenlineo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/40274/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/40274/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
