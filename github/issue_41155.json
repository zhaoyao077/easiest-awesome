{
  "url": "https://api.github.com/repos/apache/spark/issues/41155",
  "repository_url": "https://api.github.com/repos/apache/spark",
  "labels_url": "https://api.github.com/repos/apache/spark/issues/41155/labels{/name}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/41155/comments",
  "events_url": "https://api.github.com/repos/apache/spark/issues/41155/events",
  "html_url": "https://github.com/apache/spark/pull/41155",
  "id": 1707683034,
  "node_id": "PR_kwDOAQXtWs5QZBFI",
  "number": 41155,
  "title": "[SPARK-43487][SQL] Fix Nested CTE error message",
  "user": {
    "login": "johanl-db",
    "id": 112876214,
    "node_id": "U_kgDOBrpatg",
    "avatar_url": "https://avatars.githubusercontent.com/u/112876214?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/johanl-db",
    "html_url": "https://github.com/johanl-db",
    "followers_url": "https://api.github.com/users/johanl-db/followers",
    "following_url": "https://api.github.com/users/johanl-db/following{/other_user}",
    "gists_url": "https://api.github.com/users/johanl-db/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/johanl-db/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/johanl-db/subscriptions",
    "organizations_url": "https://api.github.com/users/johanl-db/orgs",
    "repos_url": "https://api.github.com/users/johanl-db/repos",
    "events_url": "https://api.github.com/users/johanl-db/events{/privacy}",
    "received_events_url": "https://api.github.com/users/johanl-db/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1405794576,
      "node_id": "MDU6TGFiZWwxNDA1Nzk0NTc2",
      "url": "https://api.github.com/repos/apache/spark/labels/SQL",
      "name": "SQL",
      "color": "ededed",
      "default": false,
      "description": null
    },
    {
      "id": 1981527456,
      "node_id": "MDU6TGFiZWwxOTgxNTI3NDU2",
      "url": "https://api.github.com/repos/apache/spark/labels/CORE",
      "name": "CORE",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-05-12T13:55:14Z",
  "updated_at": "2023-05-22T20:45:44Z",
  "closed_at": "2023-05-22T20:45:44Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/apache/spark/pulls/41155",
    "html_url": "https://github.com/apache/spark/pull/41155",
    "diff_url": "https://github.com/apache/spark/pull/41155.diff",
    "patch_url": "https://github.com/apache/spark/pull/41155.patch",
    "merged_at": null
  },
  "body": "\r\n### What changes were proposed in this pull request?\r\nThe batch of errors migrated to error classes as part of spark-40540 contains an error that got mixed up with the wrong error message:\r\n\r\n[ambiguousRelationAliasNameInNestedCTEError](https://github.com/apache/spark/commit/43a6b932759865c45ccf36f3e9cf6898c1b762da#diff-744ac13f6fe074fddeab09b407404bffa2386f54abc83c501e6e1fe618f6db56R1983) uses the same error message as the following commandUnsupportedInV2TableError:\r\n\r\nWITH t AS (SELECT 1), t2 AS ( WITH t AS (SELECT 2) SELECT * FROM t) SELECT * FROM t2;\r\nAnalysisException: t is not supported for v2 tables\r\n\r\nThe error should be:\r\n\r\nAnalysisException: Name tis ambiguous in nested CTE.\r\nPlease setÂ spark.sql.legacy.ctePrecedencePolicy to CORRECTED so that name defined in inner CTE takes precedence. If set it to LEGACY, outer CTE definitions will take precedence. See more details in SPARK-28228.\r\n\r\n### Does this PR introduce _any_ user-facing change?\r\nFix user-facing error message for ambiguous name in nested CTEs.\r\n\r\n\r\n### How was this patch tested?\r\n",
  "closed_by": {
    "login": "MaxGekk",
    "id": 1580697,
    "node_id": "MDQ6VXNlcjE1ODA2OTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1580697?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MaxGekk",
    "html_url": "https://github.com/MaxGekk",
    "followers_url": "https://api.github.com/users/MaxGekk/followers",
    "following_url": "https://api.github.com/users/MaxGekk/following{/other_user}",
    "gists_url": "https://api.github.com/users/MaxGekk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MaxGekk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MaxGekk/subscriptions",
    "organizations_url": "https://api.github.com/users/MaxGekk/orgs",
    "repos_url": "https://api.github.com/users/MaxGekk/repos",
    "events_url": "https://api.github.com/users/MaxGekk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MaxGekk/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/apache/spark/issues/41155/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/apache/spark/issues/41155/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
